# Stage 3: 任务分解

**输入**：当前开发阶段的模块列表和验收标准  
**输出**：`todolist.csv`（任务清单）、`process.md`（更新当前阶段上下文）  

---

## 执行步骤

### Step 1: 分解到可执行任务

将当前阶段的模块分解为具体的编码任务，每个任务：
- 预计完成时间：1-4 小时
- 有明确的完成标准
- 可以独立执行（减少依赖）

**任务粒度参考**：
- ✅ 好："实现 POST /api/users 接口，支持用户注册，包含参数验证和错误处理"
- ❌ 太大："实现用户系统"
- ❌ 太小："在 user.ts 中添加一个变量"

### Step 2: 技术方案简述（high 优先级任务）

对每个 **high** 优先级的任务，编写简要技术方案并交人工快速确认：

```markdown
## 任务 [id]：[任务名]

**实现思路**：[1-3 句话描述方案]
**涉及文件**：[列出需要新建/修改的文件]
**风险点**：[有则写，无则留空]
**备选方案**：[如有其他可选方案]
```

> ⚠️ 此环节仅需 1-2 分钟快速确认，目的是防止 AI 在 Stage 4 中走错方向。Medium/Low 优先级任务可跳过。

### Step 3: 更新 todolist.csv

将所有任务填入 `todolist.csv`：

```csv
id,phase,module,task,priority,status,assignee,estimated_hours,actual_hours,notes
001,1,auth,实现用户注册 API (POST /api/users),high,todo,AI,3,,需要邮箱验证
002,1,auth,实现用户登录 API (POST /api/auth/login),high,todo,AI,2,,JWT token
003,1,auth,实现 JWT 中间件,high,todo,AI,2,,依赖 002
004,1,db,创建数据库迁移脚本 - users 表,high,todo,AI,1,,
005,1,auth,编写 auth 模块单元测试,medium,todo,AI,2,,依赖 001~003
```

**状态说明**：
- `todo`：待开始
- `in-progress`：进行中
- `done`：已完成
- `blocked`：被阻塞（在 notes 中说明原因）
- `review`：等待人工验收

### Step 4: 更新 process.md

在 `process.md` 中记录本阶段上下文：

```markdown
## 当前阶段：[阶段 N] - [阶段名称]

**开始时间**：YYYY-MM-DD
**预计完成**：YYYY-MM-DD
**状态**：进行中

### 本阶段目标
[从 stage-2 规划中复制]

### 关键技术决策
- [决策1]：[选择了什么，为什么]
- [决策2]：[...]

### 已知风险
- [风险1]：[应对方案]
```

---

## AI 提示词：任务分解

```
当前阶段：阶段 [N] - [阶段名]
涉及模块：[模块列表]

请将以下模块分解为可独立执行的任务，填入 todolist.csv 格式：
- 每个任务预计 1-4 小时完成
- 标注任务间的依赖关系（在 notes 中写 "依赖 task-id"）
- 优先级：high/medium/low
- 预估时间：填写 estimated_hours
- 技术栈：[当前项目技术栈]

模块详细需求：
[从 stage-1 架构文档中复制相关内容]
```

---

## 验收标准

- [ ] todolist.csv 已更新，包含当前阶段所有任务
- [ ] 所有任务粒度合理（非太大也非太小）
- [ ] High 优先级任务已有简要技术方案
- [ ] 依赖关系已在 notes 中标注
- [ ] process.md 已更新当前阶段信息
- [ ] 人工确认任务列表合理

---

## 输出到 Stage 4

将以下内容交给 Stage 4 执行 AI：
- 更新后的 `todolist.csv`
- 更新后的 `process.md`
- High 优先级任务的技术方案（已确认）
- 当前阶段的架构文档（来自 Stage 1）

---

## ❓ 常见问题 FAQ

**Q1: 任务分解到什么粒度最合适？**  
A: 每个任务 1-4 小时可完成。如果一个任务需要拿不准的技术决策，就需要进一步拆分。

**Q2: 发现需求不明确怎么办？**  
A: 立即暂停分解，将问题记录在 process.md 的"遇到的问题"部分，等待人工澄清后再继续。

**Q3: 技术方案被否决了怎么办？**  
A: 根据反馈修改方案，重新提交确认。如果只是实现细节的调整，可以在 notes 中记录然后继续。
