# Stage 5: 审查交接（阶段出口校验 + 业务验收）

**输入**：完成代码、门禁证据、更新后的 `todolist.csv`  
**输出**：阶段审查报告、人工验收结论（通过/未通过）

---

## 定位变化

Stage 5 不再承担“技术质量兜底”。技术质量应在 Stage 4 按 `gate_profile` 已完成门禁。  
Stage 5 聚焦：
1. 阶段出口一致性校验
2. 业务功能验收
3. 发布/进入下一阶段决策

---

## Step 1: 阶段出口校验（流程完整性）

### 1) 状态与门禁字段校验

检查 `todolist.csv`：
- 状态流是否符合 `todo -> in-progress -> review -> done`
- `review_status` 是否为 `approved`
- `verify_status` 是否为 `passed`
- `evidence` 是否可复核

### 2) 分级门禁抽查

- `strict`：抽查 RED/GREEN、任务级 review、完整验证证据
- `balanced`：抽查失败→通过循环证据、批量 review 记录
- `light`：抽查最小验证与抽样 review 记录

如任一关键字段缺失：退回 Stage 4 修复。

---

## Step 2: 人工业务验收

提交审查时提供：

```markdown
## 阶段 [N] 审查报告

**阶段**：[阶段名称]
**完成时间**：[日期]
**执行工具**：[使用了哪些 AI 工具]

### 门禁执行摘要
- strict 任务：[N] 个（通过 [N] 个）
- balanced 任务：[N] 个（通过 [N] 个）
- light 任务：[N] 个（通过 [N] 个）

### 已完成功能
1. [功能1]：[如何验证]
2. [功能2]：[如何验证]

### 验收步骤（给人工执行）
1. 拉取代码：`git pull origin main`
2. 安装依赖：`npm install`
3. 启动服务：`npm run dev`
4. 业务场景测试：
   - 场景1：[步骤] -> [预期]
   - 场景2：[步骤] -> [预期]

### 已知问题/待优化
- [问题1]：[描述]（计划在阶段N修复）
```

---

## Step 3: 验收决策

### ✅ 通过（进入下一阶段）

```markdown
## 验收通过记录

**验收人**：[姓名]
**验收时间**：[日期时间]
**下一阶段**：阶段 [N+1] - [名称]
```

更新 `process.md` 阶段状态为 `done`，进入下一阶段 Stage 3。

### ❌ 未通过（返回 Stage 4）

```markdown
## 验收未通过记录

**验收人**：[姓名]
**验收时间**：[日期时间]

### 必须修复的问题
1. [问题描述1]：[期望行为]
2. [问题描述2]：[期望行为]
```

将问题回写 `todolist.csv`（`status=todo`），返回 Stage 4 修复。

---

## 阶段循环判断

```text
IF 还有未完成开发阶段:
  -> 返回 Stage 3（下一阶段任务分解）
ELSE:
  -> 项目交付
```

---

## 项目交付清单（最终阶段）

- [ ] 所有任务状态为 done 且门禁字段完整
- [ ] 业务功能验收通过
- [ ] 文档已更新（README/API/运维）
- [ ] 部署与监控准备完成
- [ ] 代码合并并打 tag
